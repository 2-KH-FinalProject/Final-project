<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>공연 예매 사이트</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="/css/performance/detail.css">
	<th:block th:replace="~{common/common}"></th:block>
</head>

<body>
	<th:block th:replace="~{common/header}"></th:block>
	<div class="performance-container" style="margin-top: 20px;">
		<div class="performance-content">
			<!-- 왼쪽: 공연 정보 -->
			<div class="performance-info">
				<img th:src="${performance.poster}" th:alt="${performance.prfnm}" class="performance-image">
				<table class="info-table">
					<tr>
						<th>공연명</th>
						<td class="performance-title" th:text="${performance.prfnm}"></td>
					</tr>
					<tr>
						<th>장소</th>
						<td class="performance-venue" th:text="${performance.fcltynm}"></td>
					</tr>
					<tr>
						<th>공연기간</th>
						<td colspan="2" th:text="${performance.prfpdfrom + ' ~ ' + performance.prfpdto}"></td>
					</tr>
					<tr>
						<th>공연시간</th>
						<td class="performance-runtime" th:text="${performance.prfruntime}"></td>
					</tr>
					<tr>
						<th>출연진</th>
						<td class="performance-actor" th:text="${performance.prfcast}"></td>
					</tr>
					<tr>
						<th>가격</th>
						<td class="performance-price" th:text="${performance.pcseguidance}"></td>
					</tr>

					<!-- 위도, 경도 -->
					<input type="hidden" id="fcltla" th:value="${performance.fcltla}">
					<input type="hidden" id="fcltlo" th:value="${performance.fcltlo}">

				</table>

				<div id="map" style="width: 600px; height: 400px;"></div>
			</div>

			<!-- 오른쪽: 예매 영역 -->
			<div class="performance-booking">
				<div class="datepicker">
					<div class="calendar-header">
						<button class="month-nav" id="prevMonth">‹</button>
						<span class="current-month" id="currentMonth"></span>
						<button class="month-nav" id="nextMonth">›</button>
					</div>
					<div class="weekdays">
						<span>일</span>
						<span>월</span>
						<span>화</span>
						<span>수</span>
						<span>목</span>
						<span>금</span>
						<span>토</span>
					</div>
					<div class="days" id="calendar-days"></div>
				</div>
				<div class="schedule-box" id="schedule-info">
					<h3 class="text-lg font-bold mb-2">선택한 날짜의 공연 시간</h3>
					<div class="selected-date" id="selected-date">날짜를 선택해주세요</div>
					<div class="time-slots" id="time-slots">
					</div>
				</div>
				<button class="booking-btn" id="booking-btn" disabled>예매하기</button>
			</div>
		</div>

		<!-- 리뷰 섹션 추가 -->
		<div class="review-section">
			<h3 class="text-xl font-bold mb-4">공연 리뷰</h3>

			<!-- 리뷰 작성 폼 -->
			<div class="review-form"
				style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
				<div class="star-rating mb-3">
					<input type="radio" name="rating" value="5" id="rate5"><label for="rate5">★</label>
					<input type="radio" name="rating" value="4" id="rate4"><label for="rate4">★</label>
					<input type="radio" name="rating" value="3" id="rate3"><label for="rate3">★</label>
					<input type="radio" name="rating" value="2" id="rate2"><label for="rate2">★</label>
					<input type="radio" name="rating" value="1" id="rate1"><label for="rate1">★</label>
				</div>
				<textarea id="reviewContent"
					style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px; resize: vertical;"
					rows="3" placeholder="공연에 대한 리뷰를 남겨주세요."></textarea>
				<button id="submitReview"
					style="width: 100%; padding: 15px; background-color: #f43142; color: white; border: none; border-radius: 4px; font-size: 1.1em; cursor: pointer; transition: all 0.2s ease;">
					리뷰 등록하기
				</button>
			</div>

			<!-- 리뷰 목록 -->
			<div id="reviewList" class="review-list">
				<!-- 리뷰 아이템들이 여기에 동적으로 추가됨 -->
			</div>
		</div>
	</div>

	<!-- hidden inputs -->
	<input type="hidden" id="currentMemberNo" th:value="${session.loginMember != null ? session.loginMember.memberNo : ''}" />
	<input type="hidden" id="fcltla" th:value="${performance.fcltla}">
	<input type="hidden" id="fcltlo" th:value="${performance.fcltlo}">
	<input type="hidden" id="mt20id" name="mt20id" th:value="${performance.mt20id}">

	<input type="hidden" id="dayOfWeek" name="dayOfWeek" value="">

	<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d1dfe0ce3f0c48b81c2a2534d1f3446a"></script>

	<script th:inline="javascript">
	    const performanceData = {
	        id: /*[[${performance.mt20id}]]*/ '',
	        startDate: /*[[${performance.prfpdfrom}]]*/ '',
	        endDate: /*[[${performance.prfpdto}]]*/ '',
	        runtime: /*[[${performance.prfruntime}]]*/ '',
	        cast: /*[[${performance.prfcast}]]*/ '',
	        venue: /*[[${performance.fcltynm}]]*/ '',
	        schedule: /*[[${performance.schedule}]]*/ {}
	    };
	</script>

	<script src="/js/performance/detail.js"></script>
	<th:block th:replace="~{common/footer}"></th:block>
</body>

</html>